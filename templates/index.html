<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Uploader & Card Search</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <div class="wrapper">
        <header>Image Uploader & Card Search</header>
        
        <!-- Display the message if available (success or error) -->
        {% if request.args.get('message') %}
        <p>{{ request.args.get('message') }}</p>
        {% endif %}

        <!-- Form for file upload -->
        <form action="/upload" method="POST" enctype="multipart/form-data">
            <div class="file-upload-area">
                <input class="file-input" type="file" name="file" accept=".png, .jpeg, .jpg, .svg" hidden>
                <img src="/static/cloud.svg" alt="Upload Icon" class="upload-icon">
                <p>Browse Image to Upload</p>
            </div>
            <div class="file-status-message"></div>
            <button type="submit" class="upload-button" disabled>Upload Image</button>
        </form>

        <!-- Display uploaded image and extracted text -->
        {% if image_path %}
        <div class="uploaded-image">
            <img src="{{ url_for('uploaded_file', filename=image_path) }}" alt="Uploaded Image">
        </div>
        <div class="detected-info">
            {% if extracted_text %}
                <h2>Extracted Text:</h2>
                <p>{{ extracted_text }}</p>
            {% endif %}
        </div>
        {% endif %}

        <!-- Card Search Form -->
        <h2>Magic: The Gathering Card Search</h2>
        <form action="{{ url_for('search_card') }}" method="POST">
            <input type="text" name="card_name" placeholder="Enter card name" required>
            <button type="submit">Search</button>
        </form>

        <!-- Display card search result -->
        {% if card_info %}
        <div class="card-info">
            <h2>Card Details:</h2>
            <p><strong>Name:</strong> {{ card_info.name }}</p>
            <p><strong>Type:</strong> {{ card_info.type_line }}</p>
            <p><strong>Mana Cost:</strong> 
                {% if mana_symbols %}
                    {% for symbol in mana_symbols %}
                        <img src="{{ symbol }}" alt="Mana Symbol" style="height: 24px;">
                    {% endfor %}
                {% else %}
                    No Mana
                {% endif %}
            </p>
            <p><strong>Description:</strong> {{ card_info.oracle_text }}</p>
            <p><strong>Price (USD):</strong> {{ card_info.usd_price }}</p>
            <div class="card-image-container">
                <img src="{{ card_info.image_url }}" alt="Card Image" class="card-image">
            </div>
        </div>
        {% endif %}
    </div>
    <script>
        //Triggers file input when the file-upload-area is clicked
        document.querySelector('.file-upload-area').addEventListener('click', function() {
            document.querySelector('.file-input').click();
        });

        //Enables the "Upload Image" button only after a file has been selected
        document.querySelector('.file-input').addEventListener('change', function() {
            const fileName = this.files[0]?.name || '';
            if (fileName) {
                document.querySelector('.file-status-message').textContent = 'File successfully selected: ' + fileName;
                document.querySelector('.upload-button').disabled = false; //Enables the upload button
            }
        });
    </script>
</body>
</html>
